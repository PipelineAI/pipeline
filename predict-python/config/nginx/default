#G#
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# http://wiki.nginx.org/Pitfalls
# http://wiki.nginx.org/QuickStart
# http://wiki.nginx.org/Configuration
#
# Generally, you will want to move this file somewhere, and start with a clean
# file but keep this around for reference. Or just disable in sites-enabled.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##
daemon off;
user  root;
worker_processes  1;

error_log  /var/log/nginx/error.log  warn;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024;
}

http {
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    keepalive_timeout  65;

    #gzip  on;
    # Default server configuration
    #
    server {
            listen 6969 default_server;
            listen [::]:6969 default_server;

            # SSL configuration
            #
            # listen 443 ssl default_server;
            # listen [::]:443 ssl default_server;
            #
            # Note: You should disable gzip for SSL traffic.
            # See: https://bugs.debian.org/773332
            #
            # Read up on ssl_ciphers to ensure a secure configuration.
            # See: https://bugs.debian.org/765782
            #
            # Self signed certs generated by the ssl-cert package
            # Don't use them in a production server!
            #
            # include snippets/snakeoil.conf;

            root /var/www/html;

            # Add index.php to the list if you are using PHP
            index index.html index.htm index.nginx-debian.html;

            server_name _;

            location /private/nginx_status {
                stub_status on;
            }

            location /prometheus/ {
              proxy_pass http://127.0.0.1:9090;
            }

            location /healthz {
              proxy_pass http://127.0.0.1:9876;
            }

            location /metrics {
              proxy_pass http://127.0.0.1:10254;
            }

            location ~ /api/v1/model/(.*)/python3/ {
              proxy_pass http://127.0.0.1:9876;
            }

            location ~ /api/v1/model/(.*)/scikit/ {
              proxy_pass http://127.0.0.1:9876;
            }

            location ~ /api/v1/model/(.*)/keras/ {
              proxy_pass http://127.0.0.1:9876;
            }

            location ~ /api/v1/model/(.*)/tensorflow/ {
              proxy_pass http://127.0.0.1:9876;
            }

            location ~ /api/v1/model/(.*)/spark/ {
              proxy_pass http://127.0.0.1:9040;
            }

            location ~ /api/v1/model/(.*)/java/ {
              proxy_pass http://127.0.0.1:9040;
            }

            location /api/v1/model/(.*)/xgboost/ {
              proxy_pass http://127.0.0.1:9040;
            }

            location /api/v1/model/(.*)/r/ {
              proxy_pass http://127.0.0.1:9040;
            }
    }
}
