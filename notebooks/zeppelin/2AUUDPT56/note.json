{
  "paragraphs": [
    {
      "title": "Import Dependencies",
      "text": "%dep\nz.reset()\nz.addRepo(\"maven central\").url(\"search.maven.org\")\nz.load(\"com.datastax.spark:spark-cassandra-connector_2.10:1.4.0-M1\")\nz.load(\"org.elasticsearch:elasticsearch-spark_2.10:2.1.0\")",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "title": true,
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435904425694_1044927616",
      "id": "20150703-062025_1689760268",
      "result": {
        "code": "ERROR",
        "type": "TEXT",
        "msg": "Must be used before SparkInterpreter (%spark) initialized"
      },
      "dateCreated": "Jul 3, 2015 6:20:25 AM",
      "dateStarted": "Sep 27, 2015 6:03:46 AM",
      "dateFinished": "Sep 27, 2015 6:03:46 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Read the real-time Likes coming from kafka",
      "text": "val likesDF \u003d sqlContext.read.format(\"org.apache.spark.sql.cassandra\").options(Map(\"keyspace\" -\u003e \"fluxcapacitor\", \"table\" -\u003e \"likes\")).load().toDF(\"from_user_id\", \"to_user_id\", \"batch_time\")",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "title": true,
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435900511434_-2036302443",
      "id": "20150703-051511_2118186706",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "likesDF: org.apache.spark.sql.DataFrame \u003d [from_user_id: int, to_user_id: int, batch_time: bigint]\n"
      },
      "dateCreated": "Jul 3, 2015 5:15:11 AM",
      "dateStarted": "Sep 27, 2015 6:03:46 AM",
      "dateFinished": "Sep 27, 2015 6:03:47 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Current count of real-time likes",
      "text": "likesDF.count()",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "title": true,
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435903555217_1061802373",
      "id": "20150703-060555_1147518830",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "res53: Long \u003d 1042\n"
      },
      "dateCreated": "Jul 3, 2015 6:05:55 AM",
      "dateStarted": "Sep 27, 2015 6:03:46 AM",
      "dateFinished": "Sep 27, 2015 6:04:14 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Use the dataFrame API to query the real-time likes",
      "text": "likesDF.select(\"from_user_id\", \"to_user_id\", \"batch_time\").collect().mkString(\"\\n\")",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "title": true,
        "tableHide": false,
        "editorHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435903580253_1496599278",
      "id": "20150703-060620_2086361325",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "res55: String \u003d \n[97875,10001,1443042112000]\n[97875,10004,1443042112000]\n[97875,10007,1443042124000]\n[97875,90001,1443042096000]\n[97875,90011,1443042102000]\n[97782,10001,1443042082000]\n[97782,10004,1443042088000]\n[97782,10011,1443042326000]\n[97782,10013,1443042088000]\n[97782,90011,1443042078000]\n[97782,90012,1443042078000]\n[97782,90014,1443042078000]\n[35698,10003,1443042214000]\n[35698,10006,1443042196000]\n[35698,10015,1443042204000]\n[35698,90006,1443042274000]\n[35698,90009,1443042174000]\n[35698,90013,1443042172000]\n[35698,90014,1443042166000]\n[77614,10008,1443042110000]\n[77614,10014,1443042102000]\n[77614,90013,1443042084000]\n[77614,90014,1443042088000]\n[52374,10001,1442977264000]\n[52374,10002,1442977458000]\n[52374,10003,1442977264000]\n[52374,10004,1442977222000]\n[52374,10005,14429774600..."
      },
      "dateCreated": "Jul 3, 2015 6:06:20 AM",
      "dateStarted": "Sep 27, 2015 6:03:47 AM",
      "dateFinished": "Sep 27, 2015 6:04:21 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Show number of distinct Real-time participating users",
      "text": "import org.apache.spark.sql.functions._\n\nlikesDF.select(countDistinct($\"from_user_id\").as(\"distinct_user_count\")).collect()(0)",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "title": true,
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435903786952_671772613",
      "id": "20150703-060946_1260514447",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "import org.apache.spark.sql.functions._\nres58: org.apache.spark.sql.Row \u003d [158]\n"
      },
      "dateCreated": "Jul 3, 2015 6:09:46 AM",
      "dateStarted": "Sep 27, 2015 6:04:15 AM",
      "dateFinished": "Sep 27, 2015 6:04:35 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "register the real-time likes as a temp table",
      "text": "likesDF.cache()\nlikesDF.registerTempTable(\"likes_temp\")",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "title": true,
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435904979849_80174944",
      "id": "20150703-062939_414600917",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "res60: likesDF.type \u003d [from_user_id: int, to_user_id: int, batch_time: bigint]\n"
      },
      "dateCreated": "Jul 3, 2015 6:29:39 AM",
      "dateStarted": "Sep 27, 2015 6:04:22 AM",
      "dateFinished": "Sep 27, 2015 6:04:35 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Show Most desirable users by Like Count",
      "text": "%sql SELECT name, count(to_user_id) as count FROM likes_temp JOIN actresses_and_actors ON (likes_temp.to_user_id \u003d actresses_and_actors.id) GROUP BY name HAVING count \u003e 0 ORDER BY count DESC",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "multiBarChart",
          "height": 300.0,
          "optionOpen": false,
          "keys": [
            {
              "name": "name",
              "index": 0.0,
              "aggr": "sum"
            }
          ],
          "values": [
            {
              "name": "count",
              "index": 1.0,
              "aggr": "sum"
            }
          ],
          "groups": [],
          "scatter": {
            "xAxis": {
              "name": "name",
              "index": 0.0,
              "aggr": "sum"
            },
            "yAxis": {
              "name": "count",
              "index": 1.0,
              "aggr": "sum"
            }
          }
        },
        "title": true,
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435904577933_-1977276639",
      "id": "20150703-062257_361919402",
      "result": {
        "code": "SUCCESS",
        "type": "TABLE",
        "msg": "name\tcount\nLeonardo DiCaprio\t82\nMorgan Freeman\t73\nSof√≠a Vergara\t65\nAshley Judd\t62\nTom Hanks\t61\nGail O\u0027Grady\t60\nTiffani Thiessen\t58\nBobbie Phillips\t50\nJohnny Depp\t49\nAnthony Hopkins\t36\nRobert De Niro\t36\nShannon Whirry\t35\nAl Pacino\t35\nMark Wahlberg\t34\nDenzel Washington\t32\nLinda Blair\t29\nRosalind Allen\t28\nJames Franco\t25\nAngell Conwell\t21\nTatyana Ali\t21\nClive Owen\t21\nShannah Laumeister\t18\nStacey Dash\t17\nKeshia Knight Pulliam\t15\nBarbara Niven\t15\nMarlon Brando\t14\nJames Gandolfini\t14\nChazz Palminteri\t13\nJohn Travolta\t13\nPam Grier\t10\n"
      },
      "dateCreated": "Jul 3, 2015 6:22:57 AM",
      "dateStarted": "Sep 27, 2015 6:04:35 AM",
      "dateFinished": "Sep 27, 2015 6:05:10 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%md ### Compare The Physical Plans Between DataFrames And SQL (Should Be Equal)",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        }
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1438120230768_-497996483",
      "id": "20150728-215030_753792481",
      "result": {
        "code": "SUCCESS",
        "type": "HTML",
        "msg": "\u003ch3\u003eCompare The Physical Plans Between DataFrames And SQL (Should Be Equal)\u003c/h3\u003e\n"
      },
      "dateCreated": "Jul 28, 2015 9:50:30 PM",
      "dateStarted": "Sep 27, 2015 6:03:46 AM",
      "dateFinished": "Sep 27, 2015 6:03:46 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Explain Plan for SQL Query",
      "text": "sqlContext.sql(\"SELECT count(to_user_id) as count FROM likes_temp GROUP BY to_user_id ORDER BY count DESC\").explain()",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "tableHide": false,
        "title": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435904897005_-1761757602",
      "id": "20150703-062817_715212992",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "\u003d\u003d Physical Plan \u003d\u003d\nSort [count#588L DESC], true\n Exchange (RangePartitioning 200)\n  Aggregate false, [to_user_id#526], [Coalesce(SUM(PartialCount#606L),0) AS count#588L]\n   Exchange (HashPartitioning 200)\n    Aggregate true, [to_user_id#526], [to_user_id#526,COUNT(to_user_id#526) AS PartialCount#606L]\n     InMemoryColumnarTableScan [to_user_id#526], (InMemoryRelation [from_user_id#525,to_user_id#526,batch_time#527L], true, 10000, StorageLevel(true, true, false, true, 1), (Project [fromuserid#522 AS from_user_id#525,touserid#523 AS to_user_id#526,batchtime#524L AS batch_time#527L]), None)\n"
      },
      "dateCreated": "Jul 3, 2015 6:28:17 AM",
      "dateStarted": "Sep 27, 2015 6:04:36 AM",
      "dateFinished": "Sep 27, 2015 6:05:10 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Explain Plan for DataFrame Query",
      "text": "likesDF.groupBy(\"to_user_id\").count().as(\"ct\").sort($\"count\".desc).explain()",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "title": true,
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435904813656_1068531928",
      "id": "20150703-062653_388339500",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "\u003d\u003d Physical Plan \u003d\u003d\nSort [count#610L DESC], true\n Exchange (RangePartitioning 200)\n  Aggregate false, [to_user_id#526], [to_user_id#526,Coalesce(SUM(PartialCount#628L),0) AS count#610L]\n   Exchange (HashPartitioning 200)\n    Aggregate true, [to_user_id#526], [to_user_id#526,COUNT(1) AS PartialCount#628L]\n     InMemoryColumnarTableScan [to_user_id#526], (InMemoryRelation [from_user_id#525,to_user_id#526,batch_time#527L], true, 10000, StorageLevel(true, true, false, true, 1), (Project [fromuserid#522 AS from_user_id#525,touserid#523 AS to_user_id#526,batchtime#524L AS batch_time#527L]), None)\n"
      },
      "dateCreated": "Jul 3, 2015 6:26:53 AM",
      "dateStarted": "Sep 27, 2015 6:05:10 AM",
      "dateFinished": "Sep 27, 2015 6:05:10 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%md ### Generate Top-K Recommendations",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        }
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1443327931442_-1682486349",
      "id": "20150927-042531_810181892",
      "result": {
        "code": "SUCCESS",
        "type": "HTML",
        "msg": "\u003ch3\u003eGenerate Top-K Recommendations\u003c/h3\u003e\n"
      },
      "dateCreated": "Sep 27, 2015 4:25:31 AM",
      "dateStarted": "Sep 27, 2015 6:03:46 AM",
      "dateFinished": "Sep 27, 2015 6:03:46 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Enrich Real-Time Likes With Actress And Actors Reference Data",
      "text": "val enrichedLikesDF \u003d likesDF.join(actressesAndActorsDF, $\"to_user_id\" \u003d\u003d\u003d $\"id\").select($\"from_user_id\", $\"to_user_id\", $\"name\", $\"bio\", $\"img\").cache()\nenrichedLikesDF.collect()",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "title": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1438122122445_605191340",
      "id": "20150728-222202_1206474036",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "enrichedLikesDF: org.apache.spark.sql.DataFrame \u003d [from_user_id: int, to_user_id: int, name: string, bio: string, img: string]\nres67: Array[org.apache.spark.sql.Row] \u003d Array([97875,10001,Leonardo DiCaprio,Few actors in the world have had a career quite as diverse as Leonardo DiCaprio\u0027s. DiCaprio has gone from relatively humble beginnings, as a supporting cast member of the sitcom Growing Pains and low budget horror movies, such as Critters 3, to a major teenage heartthrob in the 1990s, as the hunky lead actor in movies such as Romeo + Juliet and Titanic...,img/people/10001.jpg], [97875,10004,Morgan Freeman,With an authoritative voice and calm demeanor, this ever popular American actor has grown into one of the most respected figures in modern US cinema. Morgan was born in June 1937 in Memphis, Tennessee, to Mayme Edna (Revere), a teacher, and Morgan Porterfield Freeman, a barber. The young Freeman attended...,i..."
      },
      "dateCreated": "Jul 28, 2015 10:22:02 PM",
      "dateStarted": "Sep 27, 2015 6:05:10 AM",
      "dateFinished": "Sep 27, 2015 6:05:16 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Aggregate Most Desirable Users By Like Count",
      "text": "val mostDesirableUsersByLikeCountDF \u003d enrichedLikesDF.select($\"to_user_id\", $\"name\", $\"img\").groupBy($\"to_user_id\".as(\"id\"), $\"name\", $\"img\").count().sort($\"count\".desc).limit(5).cache()",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "title": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1443327429247_981995018",
      "id": "20150927-041709_316941617",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "mostDesirableUsersByLikeCountDF: org.apache.spark.sql.DataFrame \u003d [id: int, name: string, img: string, count: bigint]\n"
      },
      "dateCreated": "Sep 27, 2015 4:17:09 AM",
      "dateStarted": "Sep 27, 2015 6:05:11 AM",
      "dateFinished": "Sep 27, 2015 6:05:47 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "title": "Save in ElasticSearch",
      "text": "import org.elasticsearch.spark.sql._ \nval esConfig \u003d Map(\"pushdown\" -\u003e \"true\", \"es.nodes\" -\u003e \"demo.fluxcapacitor.com\", \"es.port\" -\u003e \"39200\")\nmostDesirableUsersByLikeCountDF.write.format(\"org.elasticsearch.spark.sql\").mode(SaveMode.Overwrite).options(esConfig).save(\"fluxcapacitor/top-users-by-count\")",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        },
        "tableHide": false,
        "title": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1435995768565_760353753",
      "id": "20150704-074248_89399310",
      "result": "org.apache.thrift.TApplicationException: Internal error processing interpret",
      "dateCreated": "Jul 4, 2015 7:42:48 AM",
      "dateStarted": "Sep 27, 2015 6:05:17 AM",
      "dateFinished": "Sep 27, 2015 6:06:11 AM",
      "status": "FINISHED",
      "errorMessage": "org.apache.zeppelin.interpreter.remote.RemoteInterpreter.interpret(RemoteInterpreter.java:227)\norg.apache.zeppelin.interpreter.LazyOpenInterpreter.interpret(LazyOpenInterpreter.java:93)\norg.apache.zeppelin.notebook.Paragraph.jobRun(Paragraph.java:212)\norg.apache.zeppelin.scheduler.Job.run(Job.java:170)\norg.apache.zeppelin.scheduler.RemoteScheduler$JobRunner.run(RemoteScheduler.java:296)\njava.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\njava.util.concurrent.FutureTask.run(FutureTask.java:262)\njava.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178)\njava.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292)\njava.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\njava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\njava.lang.Thread.run(Thread.java:745)\n",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "",
      "config": {
        "colWidth": 12.0,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {}
        }
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "jobName": "paragraph_1443325831704_2093931080",
      "id": "20150927-035031_1373657975",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT"
      },
      "dateCreated": "Sep 27, 2015 3:50:31 AM",
      "dateStarted": "Sep 27, 2015 6:05:48 AM",
      "dateFinished": "Sep 27, 2015 6:06:13 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    }
  ],
  "name": "1. Aggregations: Top-K Recommendations",
  "id": "2AUUDPT56",
  "angularObjects": {},
  "config": {
    "looknfeel": "default"
  },
  "info": {}
}
